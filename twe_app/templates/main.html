<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/css//initil.css">
    <link rel="stylesheet" type="text/css" href="/static/css/main.css">
</head>
<body>
<div class="container">
    <div class="header">
        <img class="header__icon" src="/static/image/maskBlack.png">
        <span class="header__about">
            로그아웃
        </span>
    </div>
    <div class="content">
        <div class="main__box">
            <div class="box__content">
                <form class="box__form" method='POST' action='/animated/' name='frm' enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="box__wrapTextarea">
                        <textarea
                                class="box__textarea"
                                placeholder="오늘 제일 화났던 일은&#x0a;무엇이 었나요?"
                                name="text"
                                required
                        ></textarea>
                    </div>
                    <div class="box__wrapImage">
                        <img src="" class="box__image">
                    </div>
                    <!--<div class="box__wrapImage">-->
                        <!--<i class="box__icon">x</i>-->
                    <!--</div>-->
                    <div class="box__footer">
                        <div class="box__img">
                            <label for="box__imageInput">
                                <img src="/static/image/image.png" class="box__imgIcon"/>
                            </label>
                            <input class="box__imageInput" id="box__imageInput" name="image" type="file"/>
                        </div>
                        <input class="box__button" type="button" value="버리기" onclick="clickTextarea()"/>
                    </div>
                    <input type="text" id="box__selectValue" name="selectValue" hidden>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modalWrap">
    <div class="modal">
        <div class="modal__box">
            <img class="modal__icon" src="/static/image/close.png" />
            <div class="modal__content">
                <p class="modal__topText">이 감정을</p>
                <select class="modal__select">
                    <option value="fire">불에 태워</option>
                    <option value="trashcan">쓰레기통에 버려</option>
                    <option value="car">차에 치여</option>
                    <option value="shredder">분쇄기에 갈아</option>
                    <option value="stamp">도장으로 찍어</option>
                    <option value="hammer">망치로 부셔</option>
                    <option value="paint_pot">페인트를 부어</option>
                    <option value="erase">직접 지워</option>
                </select>
                <span class="modal__bottomText">버리기</span>
            </div>
            <button class="box__button--click" onclick="clickModal()">확인</button>
        </div>
    </div>
</div>
<script>
    function clickTextarea() {
    	document.getElementsByClassName("modalWrap")[0].style.display = "flex";
	}
	function clickModal() {
        var selectValue = document.getElementsByClassName("modal__select")[0].value;
        var text = document.getElementsByClassName("box__textarea")[0].value;
        console.log(selectValue, text);
        window.open("/animated/?text="+text+"&type="+selectValue,"_self");
        //document.frm.submit();
	}

    let image = '';

    function clickModal_image(){
        var selectValue = document.getElementsByClassName("modal__select")[0].value;
        console.log(selectValue, image);
        //window.open("./animated.html?text="+image+"&type="+selectValue,"_self");
        //document.frm.submit();
    }
    $("#box__imageInput").change(function(){
        var file = this.files[0];
        var reader = new FileReader();
        reader.onloadend = function() {
            // console.log('RESULT', reader.result);
            $(".box__image").attr("src", reader.result);
            image = reader.result;
        }
        reader.readAsDataURL(file);
        // $(".box__button--click").attr("onclick", "clickModal_image()");
        $(".box__wrapTextarea").hide();
        $(".box__wrapImage").css({
            'display' : 'block'
        });
        $(".box__textarea").removeAttr('required');
    });
    $(".modal__select").change(function(){
        console.log(this.value);
        $("#box__selectValue").val(this.value);
    });
</script>
</body>
</html>